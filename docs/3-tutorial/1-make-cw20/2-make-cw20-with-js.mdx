---
sidebar_position: 3
---

# Issue and send CW20 Tokens (Javascript)

import Details from '@theme/Details';
import Ex04 from "@site/src/components/Sandpack/Ex04-make-cw20";
import Ex05 from "@site/src/components/Sandpack/Ex05-send-cw20";

Using CW20 makes it easier to connect the gaming ecosystem with the XPLA blockchain. This time, let's write code directly to issue tokens.

<Details summary="But I have zero idea what CW20 is!">

The XPLA Chain utilizes a smart contract platform called `Cosmwasm`. Just like ERC20 on Ethereum, **CW20** is the standard for Fungible tokens in `Cosmwasm`. For more, refer to the [docs for Cosmwasm](https://docs.rs/crate/cw20/0.2.3).

</Details>

## Preview {#preview}

First, here's the code to create a CW20 contract using JavaScript. Modify and run the code with your mnemonic phrase. You'll see the execution result on the right side after a short wait.

<Ex04 />

<br/>

Have you successfully created the contract? Great, then the CW20 has been issued! Now, let's try sending the issued CW20 tokens to another wallet address.

Similarly, please insert your mnemonic phrase into the code below. Afterwards, assign the address of the previously created contract to the variable `cw20_contract`. After a short wait, you'll be able to see the execution result on the right side.

<Details summary="Where can you find the address of the created contract?">

The easiest way is to use the [XPLA Explorer](https://explorer.xpla.io/). Take the transaction hash value from the execution result and search it on the [XPLA Explorer](https://explorer.xpla.io/). Then, on the Transaction Details page, go to the `Event Logs` tab to find the address of the created contract. You were able to find the example contract address [here](https://explorer.xpla.io/testnet/tx/4BC262846BFA9F845480EF1447503B3F1927CCD4E08DFB82BA91C952BAC1825E#EventLogs).

</Details>

<Ex05 />

<br/>

If you’ve understood the Preview Code, you can proceed to the [next step](/docs/tutorial/make-cw20/query-cw20) without reading the [following content](/docs/tutorial/make-cw20/make-cw20-with-js#make-cw20)!

## Issuing CW20 Tokens using JavaScript {#make-cw20}

Let's create a CW20 contract and issue CW20 tokens. The Code ID for the CW20 contract is `1` on both the mainnet and the testnet.

<Details summary="Code ID란 무엇인가요?">

EVM과 달리, Cosmwasm에서는 코드 배포(Code Deploy)와 컨트랙트 생성이 한번에 이뤄지지 않습니다. 먼저 작성한 컨트랙트 코드를 블록체인에 배포(StoreCode)하면 해당 코드의 `Code ID`를 발급 받습니다. 이후 `Code ID`를 기반으로 컨트랙트를 생성(InstantiateContract)할 수 있습니다.

똑같은 Code ID로 생성된 컨트랙트들은 모두 같은 코드 기반입니다. 다만 컨트랙트를 생성할 때 입력하는 초깃값(init_msg)이 다르면, 컨트랙트의 세부 사항도 달라집니다. 더 자세한 사항은 [XPLA Docs](https://docs.xpla.io/docs/develop/core-modules/wasm/#code-id)를 참고해보세요.

</Details>

### Run Code {#make-cw20-runcode}

1. Please create a file named "example-4.js".

2. Copy and paste the code below into the "example-4.js" file and save it.

    ```js
    const { LCDClient, MnemonicKey, MsgInstantiateContract, Fee, SignMode } = require("@xpla/xpla.js");

    const lcd = new LCDClient({
        chainID: 'cube_47-5',
        URL: 'https://cube-lcd.xpla.dev'
    });

    const main = async () => {
        const mk = new MnemonicKey({
            mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle' // 여러분의 니모닉 단어로 바꿔주세요.
        })

        const wallet = lcd.wallet(mk);
        const myWalletAddress = wallet.key.accAddress;

        const init_msg = {
            name: "My CW20 Token", // My Cw20 Token
            symbol: "MCT", // My Cw20 Token
            decimals: 6,
            initial_balances: [{ address: myWalletAddress, amount: "2000000000000000" }], // 초기 물량을 보유하고 있을 주소들을 배열로 지정합니다.
            mint: { // 추가로 mint가 필요한 경우를 대비해 minter도 지정할수 있지만 옵션입니다.
                minter: myWalletAddress
            }
        };

        const instantiate = new MsgInstantiateContract(
            myWalletAddress, // sender
            myWalletAddress, // admin
            1, // MAINNET, TESTNET CW20 code id
            init_msg,
            {}, // 컨트랙트에 전송할 XPLA 토큰 수량, 현재는 필요하지 않으니 비워둠.
            'My CW20 Token', // 작성하고 싶은 라벨을 입력해주세요.
        );

        const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝
            msgs: [instantiate]
        });

        // createAndSignTx 함수를 분리하여 직접 작성하면 아래와 같습니다.
        // const accInfo = await lcd.auth.accountInfo(myWalletAddress) // 지갑 정보 받아오기
        // const acc = accInfo;
        
        // const userSignOption = { // 서명 정보 
        // 	chainID: 'cube_47-5',
        // 	accountNumber: acc.account_number,
        // 	sequence: acc.sequence,
        // 	signMode: SignMode.SIGN_MODE_DIRECT
        // }
        
        // const fee = new Fee(3000000, "2550000000000000000axpla") // 수수료 금액 설정
        
        // const tx = await lcd.tx.create([], { msgs: [instantiate], fee }) // 트랜잭션 생성
        
        // const signedTx = await wallet.key.signTx(tx, userSignOption) // 서명

        const txResult = await lcd.tx.broadcastSync(signedTx);
        console.log(txResult.txhash);
    }
    main()
    ```

3. Please replace the mnemonic words in the 10th line with your own mnemonic phrase.

4. Enter the following command in the VSCode Terminal:

  ```bash
  node example-4.js
  ```

5. In the Terminal, you will be able to see the results. The CW20 contract will be created, and you should be able to verify the transaction hash of the creation transaction.

### Explanation {#make-cw20-explaination}

We haven't written the contract code for CW20. The code has already been deployed on the XPLA blockchain, and we've simply created the contract using the deployed code. We'll explore how to write contract code in later steps.

First, we loaded a wallet using mnemonic words. You've probably used different mnemonic words to load your own wallet.

```js
const mk = new MnemonicKey({
    mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle',
})

const wallet = lcd.wallet(mk);
const myWalletAddress = wallet.key.accAddress;
```

<br/>

To create a CW20 contract, we've pre-set some initial values. Feel free to modify the values below and create your own token.

```js
const init_msg = {
    name: "My CW20 Token", // My Cw20 Token
    symbol: "MCT", // My Cw20 Token
    decimals: 6,
    initial_balances: [{ address: myWalletAddress, amount: "2000000000000000" }], // 초기 물량을 보유하고 있을 주소들을 배열로 지정합니다.
    mint: { // 추가로 mint가 필요한 경우를 대비해 minter도 지정할수 있지만 옵션입니다.
        minter: myWalletAddress
    }
};
```

:::info

You can freely set the `decimals` value when issuing tokens. In the example initial values, we've set the `decimals` field to **6**. Just to let you know, in the case of **XPLA**, the `decimals` value is **18**. This means that 10<sup>18</sup> **aXPLA** is equal to 1 **XPLA**.

:::

<br/>

Who is creating the contract (sender), and who is the owner of the contract (admin)? You prepare for contract creation by providing the Code ID, initial values, label, and other details.

```js
const instantiate = new MsgInstantiateContract(
    myWalletAddress, // sender
    myWalletAddress, // admin
    1, // MAINNET, TESTNET CW20 code id
    init_msg,
    {}, // 컨트랙트에 전송할 XPLA 토큰 수량, 현재는 필요하지 않으니 비워둠.
    'My CW20 Token', // 작성하고 싶은 라벨을 입력해주세요.
);
```

<br/>

You generate and complete the signature for a transaction using the `createAndSignTx` function.

```js
const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝
    msgs: [instantiate]
});
```

:::info

The `createAndSignTx` function generates a transaction, automatically sets the fee amount, and proceeds with the signing process. You can also separate the roles of the `createAndSignTx` function into creating a transaction, setting the fee, and signing individually, as shown in the commented sections of the example code.

```js
const accInfo = await lcd.auth.accountInfo(myWalletAddress) // 지갑 정보 받아오기
const acc = accInfo;

const userSignOption = { // 서명 정보 
    chainID: 'cube_47-5',
    accountNumber: acc.account_number,
    sequence: acc.sequence, 
    signMode: SignMode.SIGN_MODE_DIRECT
}

const fee = new Fee(3000000, "2550000000000000000axpla") // 수수료 금액 설정

const tx = await lcd.tx.create([], { msgs: [instantiate], fee }) // 트랜잭션 생성

const signedTx = await wallet.key.signTx(tx, userSignOption) // 서명
```

:::

<br/>

You transmit the created transaction to the network using the `broadcastSync` function. If the transaction is successfully created on the XPLA blockchain, you'll be able to confirm the transaction hash value as the result.

```js
const txResult = await lcd.tx.broadcastSync(signedTx);
console.log(txResult.txhash);
```

<br/>

Check the information of the created transaction using the following code.

1. Create a file named "query-tx.js."

2. Copy and paste the code below. Instead of `ECDBC35B66384DEE25987AA0DDAE8CF946D1F4907B04A0E77939988474013353`, please insert the transaction hash value you generated earlier.

```js
const { LCDClient } = require("@xpla/xpla.js");

const lcd = new LCDClient({
	chainID: 'cube_47-5',
	URL: 'https://cube-lcd.xpla.dev'
});

async function main() {
	const txInfo = await lcd.tx.txInfo("ECDBC35B66384DEE25987AA0DDAE8CF946D1F4907B04A0E77939988474013353"); // 트랜잭션 데이터
	console.log(JSON.stringify(txInfo, null, 2));
}
main()
```

3. Execute the following command in the Terminal.

```bash
node query-tx.js
```

4. Confirm the transaction information.

<br />

Alternatively, using the [XPLA Explorer](https://explorer.xpla.io/) to check transaction data is also a good option.

So far, we've issued CW20 tokens. Using these tokens can enrich the gaming ecosystem even further. Now, it's time to distribute tokens to users. To allow users to acquire tokens, let's explore CW20 token transfers.

## Send Issued CW20 {#send-cw20}

Let's go ahead and transfer the CW20 tokens that we issued earlier. Token transfers are carried out by **Execute** the `transfer` function of the CW20 contract. For this example, we'll use the contract address of the MCT token as `xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc`, and we'll transfer the tokens to the address `xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk`.

### Run Code {#send-cw20-runcode}

1. Please create a file named example-5.js.

2. Copy the following code and paste it into the example-5.js file, then save it.

    ```js
    const { LCDClient,  MnemonicKey, MsgExecuteContract, TxAPI, Fee } = require("@xpla/xpla.js");

    const lcd = new LCDClient({
        chainID: 'cube_47-5',
        URL: 'https://cube-lcd.xpla.dev'
    });

    const main = async () => {
        const mk = new MnemonicKey({
        mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle'
        })

        const wallet = lcd.wallet(mk);
        const myWalletAddress = wallet.key.accAddress;
        
        const cw20_contract = "xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc"; // example-4.js에서 생성한 cw20 토큰의 주소로 교체합니다.

        const transferMsg = new MsgExecuteContract(
            myWalletAddress,
            cw20_contract,
            {
                transfer: {
                    recipient : "xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk",
                    amount: "100000"
                }
            }
        );
        
        const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝
            msgs: [transferMsg]
        });

        // const accInfo = await lcd.auth.accountInfo(myWalletAddress)
        // const acc = accInfo;
        
        // // 메세지에 대한 예상 트랜잭션 fee를 알아낸다.
        // const tx_api = new TxAPI(lcd)
        // const simul_fee = await tx_api.estimateFee(
        // 	[{
        //     sequenceNumber: acc.sequence,
        //     publicKey: mk.publicKey
        // }],
        // 	{
        // 		msgs: [transferMsg],
        // 		gasAdjustment: 1.25,			
        // 	}
        // )
            
        // const fee = new Fee(simul_fee.gas_limit, simul_fee.amount.toString());
        
        // const signedTx = await wallet.createAndSignTx({
        //   msgs: [transferMsg], fee
        // });

        const txResult = await lcd.tx.broadcastSync(signedTx);
        console.log(txResult.txhash);
    }

    main()
    ```

3. Please replace the mnemonic words on the 10th line with your own mnemonic words.

  Assign your contract address, which you generated during [the steps to issue CW20 tokens in JavaScript](/docs/tutorial/make-cw20/make-cw20-with-js#make-cw20), to the variable `cw20_contract` on the 16th line. In the example, replace `xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc` with your actual contract address.

  <Details summary="Where can I find the address of the contract I created?">

  The easiest way is to use the [XPLA Explorer](https://explorer.xpla.io/). Let's try searching for the transaction hash that appeared as a result of the execution on the [XPLA Explorer](https://explorer.xpla.io/). Once you're on the "Transaction Details" screen, go to the `Event Logs` tab. There, you'll be able to see the address of the contract that was created. You could find the example contract address [right there](https://explorer.xpla.io/testnet/tx/4BC262846BFA9F845480EF1447503B3F1927CCD4E08DFB82BA91C952BAC1825E#EventLogs).

  </Details>

  Finally, please write the wallet address where you will receive the CW20 tokens in the `recipient` field on the 23rd line. Instead of the example address `xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk`, enter your own wallet address where you'll be receiving the CW20 tokens.

  :::tip
  
  Don't have a wallet to receive the tokens? You can create an additional wallet using Vault and use that address, or alternatively, you can use the same sending wallet address as the receiving address. You can send tokens to yourself.
    
  :::

4. Enter the following command in VSCode Terminal

  ```bash
  node example-5.js
  ```

5. Check the results in the Terminal. You'll see that the CW20 tokens have been sent, and you'll be able to verify the transaction's hash value.

### Description {#send-cw20-explaination}

Sending CW20 tokens works differently from sending XPLA coins. While XPLA coin transfers use the `MsgSend` method, CW20 token transfers are done by **Execute** the `transfer` function of the CW20 contract. This is why we use the `MsgExecuteContract` method.

First, you've loaded the wallet with your mnemonic words. You might have used different mnemonic words to load your wallet.

```js
const mk = new MnemonicKey({
    mnemonic: 'myth snow ski simple century dad gun dolphin sail lawsuit fringe image toast betray frown keep harbor flash table prevent isolate panic tag vehicle',
})

const wallet = lcd.wallet(mk);
const myWalletAddress = wallet.key.accAddress;
```

<br/>

Then, we've specified the contract address of the token. You would have also assigned the contract address of the token you created.

Next, we've indicated who the transfer is going to and how much CW20 you're sending. In the `amount` field, you specify the quantity in uCW20 units. Remember that [when you created the contract](/docs/tutorial/make-cw20/make-cw20-with-js#make-cw20-explaination), the `decimal value` was set to **6**. So, if you have 100,000 **uCW20**, you'll be sending 0.1 **CW20**.

```js
const cw20_contract = "xpla1xljvdrtyn86kv7hrdhae4qxdy8krajah3w7xhtyrt0n69und9xdqdhrasc"; // example-4.js에서 생성한 cw20 토큰의 주소로 교체합니다.

const transferMsg = new MsgExecuteContract(
    myWalletAddress,
    cw20_contract,
    {
        transfer: {
            recipient : "xpla1cwduqw0z8y66mnfpev2mvrzzzu98tuexepmwrk",
            amount: "100000"
        }
    }
);
```

<br/>

Use the `createAndSignTx` function to generate a transaction and go through the signing process as well.

```js
const signedTx = await lcd.wallet(mk).createAndSignTx({ // 트랜잭션 생성 및 사이닝
    msgs: [transferMsg]
});
```

:::info

The function `createAndSignTx` handles creating transactions, automatically setting the fee amount, and performing the signing process. In the steps to [issue CW20 tokens using JavaScript](/docs/tutorial/make-cw20/make-cw20-with-js#make-cw20-explaination), I also provided separate code for each of these steps.

Now, let's take a look at the code that uses the `estimateFee` function to create transactions. Similarly, replace the `createAndSignTx` function with the code below and give it a try:

```js
const accInfo = await lcd.auth.accountInfo(myWalletAddress)
const acc = accInfo;

// 메세지에 대한 예상 트랜잭션 fee를 알아낸다.
const tx_api = new TxAPI(lcd)
const simul_fee = await tx_api.estimateFee(
    [{
    sequenceNumber: acc.sequence,
    publicKey: mk.publicKey
}],
    {
        msgs: [transferMsg],
        gasAdjustment: 1.25,			
    }
)
    
const fee = new Fee(simul_fee.gas_limit, simul_fee.amount.toString());

const signedTx = await wallet.createAndSignTx({
    msgs: [transferMsg], fee
});
```

Just as the `createAndSignTx` function automatically set the fee amount, this time we've used the `estimateFee` function to set the fee. All the modules used in the example are included in the `@xpla/xpla.js` package.

:::

<br/>

Use the `broadcastSync` function to send the created transaction to the network. If the transaction has been successfully created on the XPLA blockchain, you should be able to see the transaction hash as the result.

```js
const txResult = await lcd.tx.broadcastSync(signedTx);
console.log(txResult.txhash);
```

<br />

Did you receive the transaction hash value? Use the [XPLA Explorer](https://explorer.xpla.io/) to check the transaction data and details.

## Conclusion {#conclusion}

We've looked into transferring CW20 tokens like this. Now, let's connect CW20 tokens to your game with the XPLA blockchain! In the [next chapter](/docs/tutorial/make-cw20/query-cw20), we will retrieve data of the CW20 token we created ourselves from the blockchain.